<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Installation - OEPS Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Installation";
        var mkdocs_page_input_path = "guides/install.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
 <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> OEPS Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../legacy-migration/">Migration/Restructure 2023</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Installation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#oeps-explorer">OEPS Explorer</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#more-about-mapbox-dependencies">More about Mapbox dependencies</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#oeps-backend">OEPS Backend</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#install-python-dependencies">Install Python dependencies</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#dev-dependencies">Dev dependencies</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docs-dependencies">Docs dependencies</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#table-definitions">Table Definitions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#structure">Structure</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#field-descriptors">Field Descriptors</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#herop_id-field">HEROP_ID Field</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#geometry-fields">Geometry Fields</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#example">Example</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#documentation-site">Documentation Site</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started-with-cli/">Getting Started with the CLI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../provisioning-oeps-explorer/">Provisioning OEPS Explorer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding-data-to-oeps/">Adding Data to OEPS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exporting-data-from-oeps/">Exporting Data from OEPS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uploading-oeps-data-to-bigquery/">Uploading OEPS Data to BigQuery</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../analyzing-oeps-data-in-bigquery/">Analyzing OEPS Data in BigQuery</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Registry</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../registry/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../registry/themes-constructs/">Themes &amp; Constructs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../registry/variables/">Variables</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../registry/table-sources/">Table Sources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../registry/geodata-sources/">Geodata Sources</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">CLI Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/bigquery-export/">bigquery-export</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/bigquery-upload/">bigquery-upload</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/build-docs/">build-docs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/build-explorer-docs/">build-explorer-docs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/build-explorer-map/">build-explorer-map</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/create-data-dictionaries/">create-data-dictionaries</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/inspect-csv/">inspect-csv</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/merge-data-table/">merge-data-table</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/cli/validate-registry/">validate-registry</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">OEPS Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Guides</li>
      <li class="breadcrumb-item active">Installation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="installation">Installation</h1>
<p>The OEPS Explorer, OEPS Backend (which contains the registry), and this set of documentation each live in different directories of the same repository: <a href="https://github.com/healthyregions/oeps">github.com/healthyregions/oeps</a>. Each component operates independently, so there is no need to install them all at once.</p>
<p>To begin, clone the repo locally,</p>
<pre><code class="language-shell">git clone https://github.com/healthyregions/oeps
</code></pre>
<p>then you can install any of the following components:</p>
<ul>
<li><a href="#oeps-explorer">OEPS Explorer</a></li>
<li><a href="#oeps-backend">OEPS Backend</a></li>
<li><a href="#documentation-site">Documentation Site</a></li>
</ul>
<h2 id="oeps-explorer">OEPS Explorer</h2>
<p>To get started locally with the explorer:</p>
<pre><code>
cd oeps/explorer
yarn install
cp .env.example .env
</code></pre>
<p>Some environment variable values will already be set in <code>.env</code>, but you'll need to add a Mapbox token. Then run</p>
<pre><code>yarn dev
</code></pre>
<p>and open <code>http://localhost:3000</code></p>
<h3 id="more-about-mapbox-dependencies">More about Mapbox dependencies</h3>
<p>Two Mapbox Tilesets must be configured externally and linked within this app, one for Zip Code Tabulation Areas (ZCTAs) and one for Census Tracts. These geometries are joined with CSV tables to drive map visualizations.</p>
<p>Additionally, a basemap style must be provided, as well as a Mapbox access token. All of these elements are (currently) provided through environment variables, so make sure your <code>.env</code> file has the following:</p>
<pre><code>NEXT_PUBLIC_MAPBOX_TOKEN=&lt;your token&gt;
NEXT_PUBLIC_MAPBOX_STYLE=&quot;mapbox://styles/&lt;account id&gt;/&lt;style id&gt;'
</code></pre>
<h2 id="oeps-backend">OEPS Backend</h2>
<h3 id="install-python-dependencies">Install Python dependencies</h3>
<ol>
<li>
<p>Clone this repo</p>
<pre><code>git clone https://github.com/healthyregions/oeps
cd oeps/backend
</code></pre>
</li>
<li>
<p>Create and activate a <a href="https://realpython.com/python-virtual-environments-a-primer/">Python virtual environment</a> with <a href="https://docs.python.org/3/library/venv.html">venv</a>, <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html">Conda</a>, or your other tool of choice.</p>
<p>For example, using the <code>venv</code> module that is included in Python 3, the commands will be:</p>
<pre><code>python3 -m venv env
source ./env/bin/activate
</code></pre>
<p>This will create a new directory <code>env/</code>, and when properly activated your command prompt will have a <code>(env)</code> prefix.</p>
</li>
<li>
<p>Install this package and its dependencies</p>
<pre><code>pip install -e .
</code></pre>
</li>
<li>
<p>Create a <code>.env</code> file from the provided template (no need to update any values right now)</p>
<pre><code>cp .env.example .env
</code></pre>
</li>
</ol>
<p>Success! To test your install, run:</p>
<pre><code class="language-shell">flask --help
</code></pre>
<p>You should see a printout that lists about 10 commands.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you only see three commands (<code>routes</code>, <code>run</code>, and <code>shell</code>), then you either need to activate your virtual environment or make sure you have a <code>.env</code> file with <code>FLASK_APP=oeps</code> in it. (These three are default Flask commands.)</p>
</div>
<p>You can now head to <a href="../getting-started-with-cli/">Getting Started with the CLI</a> to learn more about using these commands.</p>
<h3 id="dev-dependencies">Dev dependencies</h3>
<p>If you are contributing code or otherwise developing on this code base, use the following commands to install dev dependencies</p>
<pre><code class="language-shell">pip install -e .[dev]
pip install md-click@git+https://github.com/kid-116/md-click@support-arguments
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>md-click</code> library is used to generate documentation of the CLI commands, and the particular branch is needed to handle Arguments on the commands that are being documented. Hopefully, this PR will be merged at some point and this install process could be updated: https://github.com/RiveryIO/md-click/pull/12.<br/><br/>There is a dependency resolution bug (or something) when putting that github reference directly in the <code>pyproject.toml</code> file, so it needs to be run separately after everything else is installed.</p>
</div>
<h3 id="docs-dependencies">Docs dependencies</h3>
<p>The <a href="#documentation-site">documentation site</a> (which you are reading right now!) is built with dependencies that are best installed directly into the backend virtual environment, so may as well install them now:</p>
<pre><code class="language-shell">pip install -e .[docs]
</code></pre>
<h3 id="table-definitions">Table Definitions</h3>
<p>A <strong>table definition</strong> is a JSON file that specifies</p>
<ol>
<li>The location of a source dataset to load</li>
<li>The Google BigQuery project and table name to load into</li>
<li>A thorough schema defining all fields from the source dataset and how they will be stored in BigQuery</li>
</ol>
<p>This information is used in various contexts to</p>
<ol>
<li>Create (or re-create) table schemas in BigQuery</li>
<li>Load data into these tables</li>
<li>Export data from BigQuery into various formats and file types</li>
</ol>
<p>The structure of a table definition is inspired by the <a href="https://specs.frictionlessdata.io/table-schema">Table Schema</a> specification published by <a href="https://specs.frictionlessdata.io">Frictionless Standards</a>, with a few additions for our own use case.</p>
<h4 id="structure">Structure</h4>
<p>The top-level properties of a table definition are:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td>String</td>
<td>Path or URL for CSV or SHP dataset to load</td>
</tr>
<tr>
<td><code>bq_table_name</code></td>
<td>String</td>
<td>Target table in BigQuery</td>
</tr>
<tr>
<td><code>bq_dataset_name</code></td>
<td>String</td>
<td>Target dataset in BigQuery</td>
</tr>
<tr>
<td><code>fields</code></td>
<td>List</td>
<td>List of definitions for all table fields</td>
</tr>
</tbody>
</table>
<p>Note that in BigQuery, a <code>dataset</code> is akin to a database in other RDBS implementations, such that a dataset holds one or more tables. Often, tables are identified by their fully-qualified identifier: <code>project_id.dataset_name.table_name</code>.</p>
<p>The <code>fields</code> property is a list of one or more field objects, as described below. The only requirement of the <code>fields</code> list is that <strong>must</strong> contain an entry for a <a href="#herop_id-field"><code>HEROP_ID</code></a> field. This is our unique GIS join field.</p>
<h4 id="field-descriptors">Field Descriptors</h4>
<h4 id="herop_id-field">HEROP_ID Field</h4>
<p>For now, please see <a href="https://github.com/GeoDaCenter/opioid-policy-scan/issues/68#issuecomment-1701863572">this comment</a> for a detailed description of how <code>HEROP_ID</code> values are constructed.</p>
<p>A field descriptor for this field will look something like this:</p>
<pre><code>{
    &quot;name&quot;: &quot;HEROP_ID&quot;,
    &quot;type&quot;: &quot;string&quot;,
    &quot;example&quot;: &quot;040US01-2018&quot;,
    &quot;description&quot;: &quot;A derived unique id corresponding to the relevant geographic unit.&quot;,
    &quot;theme&quot;: &quot;Geography&quot;,
}
</code></pre>
<h4 id="geometry-fields">Geometry Fields</h4>
<p>To load a shapefile you must include the following field descriptor in your <code>fields</code> list:</p>
<pre><code>{
    &quot;name&quot;: &quot;geom&quot;,
    &quot;title&quot;: &quot;Geom&quot;,
    &quot;type&quot;: &quot;string&quot;
}
</code></pre>
<p>Note that for spatial data Table Schema only allows <code>geojson</code> or <code>geopoint</code> as valid geographic types, while Google BigQuery uses <code>GEOGRAPHY</code>. For now, we'll just use the above configuration, and more nuances can be pursued down the road. </p>
<h4 id="example">Example</h4>
<p>The following is a truncated version of a table definition for the 2010 State-level data published in OEPS v2.0. This defines a table <code>project_id.tabular.S_2010</code> with two fields, <code>HEROP_ID</code> and <code>TotPop</code>. Note also the direct URL to the raw <code>path</code> on GitHub.</p>
<pre><code>{
    &quot;bq_dataset_name&quot;: &quot;tabular&quot;,
    &quot;bq_table_name&quot;: &quot;S_2010&quot;,
    &quot;path&quot;: &quot;https://raw.githubusercontent.com/GeoDaCenter/opioid-policy-scan/main/data_final/full_tables/S_2010.csv&quot;,
    &quot;fields&quot;: [
        {
            &quot;name&quot;: &quot;HEROP_ID&quot;
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;A derived unique id corresponding to the relevant geographic unit.&quot;,
            &quot;constraints&quot;: null,
            &quot;theme&quot;: &quot;Geography&quot;
        },
        {
            &quot;name&quot;: &quot;TotPop&quot;
            &quot;type&quot;: &quot;integer&quot;,
            &quot;example&quot;: &quot;7294336&quot;,
            &quot;description&quot;: &quot;Estimated total population&quot;,
            &quot;constraints&quot;: null,
            &quot;theme&quot;: &quot;Social&quot;,
            &quot;source&quot;: &quot;American Community Survey 2014-2018 5 Year Estimates; 2010 Decennial Census; Integrated Public Use Microdata Service National Historic Geographic Information Systems&quot;,
            &quot;comments&quot;: &quot;1980, 1990, and 2000 data from respective decennial censuses downloaded from IPUMS NHGIS and aggregated upwards.&quot;
        }
    ]
}
</code></pre>
<h2 id="documentation-site">Documentation Site</h2>
<p>This documentation content is built with <a href="https://www.mkdocs.org/">mkdocs</a> and hosted on Github pages. It is easiest to install the documentation dependencies directly into the backend's Python virtual environment, as <a href="#docs-dependencies">described above</a>. Once that is completed, enter the docs directory and run mkdocs commands from there.</p>
<p>To view the docs locally:</p>
<pre><code class="language-shell">cd oeps/docs
mkdocs serve
</code></pre>
<p>Visit http://localhost:8000 for a live preview of the docs content, and make changes to Markdown files in <code>/docs/src</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Keep in mind that <em>some</em> documentation content, like the command specs reference, is autogenerated by backend commands so those files should not be edited directly.</p>
</div>
<p>To build and publish the docs:</p>
<pre><code class="language-shell">mkdocs build
</code></pre>
<p>Updated content is now in <code>/docs/output</code>. Commit these changes and push to Github to rebuild the public site.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../legacy-migration/" class="btn btn-neutral float-left" title="Migration/Restructure 2023"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../getting-started-with-cli/" class="btn btn-neutral float-right" title="Getting Started with the CLI">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../legacy-migration/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../getting-started-with-cli/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
</script></body>
</html>
