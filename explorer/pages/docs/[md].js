import Head from "next/head";
import Link from 'next/link';
import { useRouter } from 'next/router'
import styles from "./MarkdownDocs.module.css";
import { useState, useEffect } from "react";
import { Gutter } from "../../components/layout/Gutter";
import MainNav from "../../components/layout/MainNav";
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm'
import Footer from "../../components/layout/Footer";

const BASE_DOCS_URL = 'https://raw.githubusercontent.com/healthyregions/oeps/main/metadata/'
const fetchMarkdown = async (url) => await fetch(url).then(r => r.text()).then(r => r.replace('[here](/data_final).', '[here](/download).'))

export default function MarkdownDocs() {
  const router = useRouter()
  const { md } = router.query
  const [markdownText, setMarkdownText] = useState('## Loading...')

  useEffect(() => {
    if (md !== undefined){
      try {
        fetchMarkdown(`${BASE_DOCS_URL}${md}.md`).then(result => setMarkdownText(result))
      } catch(e) {
        setMarkdownText('## Error - Could not locate information.')
      }
    }
  },[md])

  return (
    <div className={styles.container}>
      <Head>
        <title>OEPS Docs :: {md}</title>
        <meta name="description" content="Generated by create next app" />
        <script defer data-domain="oeps.healthyregions.org" src="https://plausible.io/js/script.js"></script>
        <link rel="icon" href="/favicon.ico" />

      </Head>
      <MainNav />
      <main className={styles.main}>
        <h1 className={styles.title}>
          {md}
        </h1>
        <div className={styles.markdownContainer}>
          <Link href='/docs'>Return to docs</Link>
          <ReactMarkdown remarkPlugins={[remarkGfm]}>{markdownText}</ReactMarkdown>
        </div>
        <Gutter em={5} />
      </main>
      <Footer />
    </div>
  );
}
